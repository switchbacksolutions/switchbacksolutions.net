---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/Header.astro';
import { getCollection } from 'astro:content';
import { marked } from 'marked';

export async function getStaticPaths() {
  const portfolioEntries = await getCollection('portfolio');
  return portfolioEntries.map((entry) => ({
    params: { id: entry.id },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const item = {
  id: entry.id,
  title: entry.data.title,
  client: entry.data.client,
  description: entry.data.description,
  fullDescription: entry.data.fullDescription,
  categories: entry.data.categories,
  industries: entry.data.industries,
  technologies: entry.data.technologies,
  year: entry.data.year,
  screenshot: entry.data.screenshot,
  url: entry.data.url,
  featured: entry.data.featured,
};
const htmlContent = entry.body ? await marked(entry.body) : '';
---

<BaseLayout title={`${item.title} - Switchback Solutions`}>
  <Header />
  
  <main>
    <article class="portfolio-detail">
      <div class="detail-hero">
        <div class="container">
          <div class="detail-header">
            <div class="detail-meta">
              <span class="detail-year">{item.year}</span>
              <span class="detail-client">{item.client}</span>
            </div>
            <h1 class="detail-title">{item.title}</h1>
          </div>
        </div>
      </div>

      {item.screenshot && (
        <div class="detail-screenshot">
          <div class="container">
            <img 
              src={item.screenshot} 
              alt={`${item.title} screenshot`}
              class="screenshot-image"
            />
          </div>
        </div>
      )}

      <div class="detail-content">
        <div class="container">
          <div class="detail-grid">
            <div class="detail-main">
              <div class="detail-description">
                <h2>About This Project</h2>
                <p>{item.fullDescription || item.description}</p>
                {htmlContent && (
                  <div class="detail-content-markdown" set:html={htmlContent} />
                )}
              </div>

              {item.url && (
                <div class="detail-link">
                  <a href={item.url} target="_blank" rel="noopener noreferrer" class="external-link">
                    Visit Project →
                  </a>
                </div>
              )}
            </div>

            <aside class="detail-sidebar">
              <div class="detail-info">
                <h3>Categories</h3>
                <div class="tag-group">
                  {item.categories.map((cat) => (
                    <span class="tag">{cat}</span>
                  ))}
                </div>
              </div>

              <div class="detail-info">
                <h3>Industries</h3>
                <div class="tag-group">
                  {item.industries.map((industry) => (
                    <span class="tag">{industry}</span>
                  ))}
                </div>
              </div>

              <div class="detail-info">
                <h3>Technologies</h3>
                <div class="tag-group">
                  {item.technologies.map((tech) => (
                    <span class="tag tag-tech">{tech}</span>
                  ))}
                </div>
              </div>
            </aside>
          </div>
        </div>
      </div>

      <div class="detail-navigation">
        <div class="container">
          <a href="/work" class="back-link">← Back to Work</a>
        </div>
      </div>
    </article>
  </main>

  <footer class="footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-logo">
          <div class="logo-icon-small">S</div>
          <div class="footer-logo-text">
            <div>SWITCHBACK</div>
            <div>SOLUTIONS</div>
          </div>
        </div>
        <p class="footer-tagline">Tech that Moves with You</p>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2024 Switchback Solutions. All rights reserved.</p>
      </div>
    </div>
  </footer>
</BaseLayout>

<style>
  main {
    padding-top: 80px;
  }

  .portfolio-detail {
    background-color: var(--color-light);
  }

  .detail-hero {
    padding: 4rem 0 3rem;
    background-color: var(--color-light);
    border-bottom: 1px solid rgba(0, 0, 0, 0.05);
  }

  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 2rem;
  }

  .detail-header {
    max-width: 900px;
  }

  .detail-meta {
    display: flex;
    gap: 1.5rem;
    margin-bottom: 1rem;
    font-family: 'Source Sans Pro', sans-serif;
    font-size: 0.95rem;
    color: var(--color-dark);
    opacity: 0.7;
  }

  .detail-year {
    font-weight: 600;
  }

  .detail-title {
    font-family: 'Raleway', sans-serif;
    font-size: clamp(2.5rem, 5vw, 4rem);
    font-weight: 600;
    color: var(--color-primary);
    margin: 0;
    line-height: 1.2;
  }

  .detail-screenshot {
    padding: 3rem 0;
    background-color: white;
  }

  .screenshot-image {
    width: 100%;
    height: auto;
    border-radius: 8px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    display: block;
  }

  .detail-content {
    padding: 4rem 0;
  }

  .detail-grid {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 4rem;
    max-width: 1200px;
  }

  .detail-main h2 {
    font-family: 'Raleway', sans-serif;
    font-size: 2rem;
    font-weight: 600;
    color: var(--color-primary);
    margin-bottom: 1.5rem;
  }

  .detail-description p {
    font-family: 'Source Sans Pro', sans-serif;
    font-size: 1.125rem;
    line-height: 1.8;
    color: var(--color-dark);
    margin-bottom: 2rem;
  }

  .detail-content-markdown {
    font-family: 'Source Sans Pro', sans-serif;
    font-size: 1.125rem;
    line-height: 1.8;
    color: var(--color-dark);
    margin-top: 2rem;
  }

  .detail-content-markdown h2 {
    font-family: 'Raleway', sans-serif;
    font-size: 1.75rem;
    font-weight: 600;
    color: var(--color-primary);
    margin-top: 2rem;
    margin-bottom: 1rem;
  }

  .detail-content-markdown h3 {
    font-family: 'Raleway', sans-serif;
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--color-primary);
    margin-top: 1.5rem;
    margin-bottom: 0.75rem;
  }

  .detail-content-markdown ul,
  .detail-content-markdown ol {
    margin: 1rem 0;
    padding-left: 2rem;
  }

  .detail-content-markdown li {
    margin: 0.5rem 0;
  }

  .detail-content-markdown p {
    margin: 1rem 0;
  }

  .detail-link {
    margin-top: 2rem;
  }

  .external-link {
    display: inline-block;
    font-family: 'Source Sans Pro', sans-serif;
    font-size: 1rem;
    font-weight: 500;
    color: var(--color-primary);
    text-decoration: none;
    padding: 0.75rem 1.5rem;
    border: 2px solid var(--color-primary);
    border-radius: 6px;
    transition: background-color 0.2s, color 0.2s;
  }

  .external-link:hover {
    background-color: var(--color-primary);
    color: white;
  }

  .detail-sidebar {
    display: flex;
    flex-direction: column;
    gap: 2rem;
  }

  .detail-info h3 {
    font-family: 'Raleway', sans-serif;
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--color-dark);
    margin-bottom: 1rem;
  }

  .tag-group {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .tag {
    display: inline-block;
    font-family: 'Source Sans Pro', sans-serif;
    font-size: 0.875rem;
    padding: 0.375rem 0.875rem;
    background-color: var(--color-secondary);
    color: var(--color-dark);
    border-radius: 4px;
    font-weight: 500;
  }

  .tag-tech {
    background-color: rgba(46, 93, 71, 0.1);
    color: var(--color-primary);
  }

  .detail-navigation {
    padding: 3rem 0;
    background-color: var(--color-light);
    border-top: 1px solid rgba(0, 0, 0, 0.05);
  }

  .back-link {
    font-family: 'Source Sans Pro', sans-serif;
    font-size: 1rem;
    font-weight: 500;
    color: var(--color-primary);
    text-decoration: none;
    transition: opacity 0.2s;
  }

  .back-link:hover {
    opacity: 0.7;
  }

  .footer {
    background-color: var(--color-primary);
    color: white;
    padding: 3rem 0 2rem;
  }

  .footer-content {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 2rem;
    flex-wrap: wrap;
    gap: 2rem;
  }

  .footer-logo {
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .logo-icon-small {
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Raleway', sans-serif;
    font-weight: 700;
    font-size: 1.25rem;
    color: white;
    border: 2px solid white;
    border-radius: 4px;
  }

  .footer-logo-text {
    display: flex;
    flex-direction: column;
    font-family: 'Raleway', sans-serif;
    font-weight: 700;
    font-size: 0.875rem;
    letter-spacing: 0.05em;
    line-height: 1.2;
  }

  .footer-tagline {
    font-family: 'Source Sans Pro', sans-serif;
    font-size: 1rem;
    opacity: 0.9;
  }

  .footer-bottom {
    text-align: center;
    padding-top: 2rem;
    border-top: 1px solid rgba(255, 255, 255, 0.2);
    font-size: 0.875rem;
    opacity: 0.7;
  }

  @media (max-width: 968px) {
    .detail-grid {
      grid-template-columns: 1fr;
      gap: 3rem;
    }

    .detail-sidebar {
      flex-direction: row;
      flex-wrap: wrap;
    }

    .detail-info {
      flex: 1;
      min-width: 200px;
    }
  }

  @media (max-width: 768px) {
    .detail-hero {
      padding: 3rem 0 2rem;
    }

    .container {
      padding: 0 1.5rem;
    }

    .detail-screenshot {
      padding: 2rem 0;
    }

    .detail-content {
      padding: 3rem 0;
    }

    .detail-sidebar {
      flex-direction: column;
    }
  }
</style>

